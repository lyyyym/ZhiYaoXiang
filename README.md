# ZhiYaoXiangï¼ˆæ™ºè¯ç®±ï¼‰

------

è¿™æ˜¯ä¸€ä¸ªåŸºäº **MindSpore** å’Œ **Qwen2.5-7B** å¤§æ¨¡å‹çš„æ™ºèƒ½åŒ»ç–—é—®ç­”ç³»ç»Ÿï¼Œä¸“ä¸º **æ— äººå”®è¯æœº** åœºæ™¯è®¾è®¡ã€‚

æœ¬é¡¹ç›®é‡‡ç”¨ **RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)** + **LoRA å¾®è°ƒ** çš„æ¶æ„ï¼Œæ—¨åœ¨è§£å†³æ— äººå”®è¯åœºæ™¯ä¸‹çš„ä¸¤å¤§æ ¸å¿ƒç—›ç‚¹ï¼š

1. **åº“å­˜å®æ—¶æ€§**ï¼šé€šè¿‡ RAG æŒ‚è½½æœ¬åœ°è¯å“æ•°æ®åº“ï¼Œç¡®ä¿æ¨èçš„è¯å“æ˜¯æœºå™¨å†…â€œç°è´§â€ã€‚
2. **å›ç­”ä¸¥è°¨æ€§**ï¼šé€šè¿‡ LoRA å¾®è°ƒï¼Œä½¿æ¨¡å‹ä¸¥æ ¼éµå¾ªåŒ»å­¦è¯´æ˜ä¹¦ï¼Œå¹¶å¯¹ç¦å¿Œç—‡ï¼ˆå¦‚å­•å¦‡ã€è¿‡æ•ï¼‰è¿›è¡Œå¼ºåˆ¶å®‰å…¨æ£€æŸ¥ã€‚

------

## é¡¹ç›®èƒŒæ™¯

éšç€æ™ºæ…§åŒ»ç–—å’Œæ–°é›¶å”®çš„å‘å±•ï¼Œæ— äººå”®è¯æœºä½œä¸ºâ€œ24å°æ—¶ä¸æ‰“çƒŠçš„å¾®å‹è¯æˆ¿â€ï¼Œæ­£åœ¨ç¤¾åŒºã€å†™å­—æ¥¼å’Œäº¤é€šæ¢çº½è¿…é€Ÿæ™®åŠã€‚ç„¶è€Œï¼Œå½“å‰çš„æ— äººå”®è¯ç»ˆç«¯æ™®éé¢ä¸´**â€œæœ‰å”®å–æ— æœåŠ¡â€**çš„å›°å¢ƒï¼š

1. **é€‰è¯å†³ç­–éš¾**ï¼šç”¨æˆ·ï¼ˆå°¤å…¶æ˜¯æ·±å¤œèº«ä½“ä¸é€‚æ—¶ï¼‰å¾€å¾€ç¼ºä¹ä¸“ä¸šåŒ»å­¦çŸ¥è¯†ï¼Œé¢å¯¹ç³ç…æ»¡ç›®çš„è¯å“ï¼Œéš¾ä»¥æ ¹æ®è‡ªèº«ç—‡çŠ¶å‡†ç¡®åˆ¤æ–­â€œè¯¥ä¹°å“ªä¸€ç§â€ã€‚
2. **ç”¨è¯å®‰å…¨éšæ‚£**ï¼šç¼ºä¹é©»åº—è¯å¸ˆçš„å®æ—¶æŒ‡å¯¼ï¼Œæ™®é€šç”¨æˆ·ææ˜“å¿½è§†æ½œåœ¨çš„è¯ç‰©ç¦å¿Œï¼ˆå¦‚å­•å¦‡ã€å„¿ç«¥ã€è¯ç‰©è¿‡æ•æˆ–è‚è‚¾åŠŸèƒ½ä¸å…¨ï¼‰ï¼Œå­˜åœ¨é”™æœã€è¯¯æœé£é™©ã€‚
3. **å¤§æ¨¡å‹è½åœ°çš„â€œæœ€åä¸€å…¬é‡Œâ€**ï¼šé€šç”¨çš„åŒ»ç–—å¤§æ¨¡å‹è™½ç„¶çŸ¥è¯†æ¸Šåšï¼Œä½†**ä¸çŸ¥é“å½“å‰æœºå™¨é‡Œå…·ä½“å–ä»€ä¹ˆè¯**ï¼ˆåº“å­˜å‰²è£‚ï¼‰ï¼Œä¸”å®¹æ˜“äº§ç”Ÿå¹»è§‰ï¼ˆæ¨èä¹°ä¸åˆ°çš„è¯ï¼‰ã€‚

**æœ¬é¡¹ç›®æ—¨åœ¨è§£å†³ä¸Šè¿°æ ¸å¿ƒç—›ç‚¹**ã€‚æˆ‘ä»¬åˆ©ç”¨ **MindSpore** æ¡†æ¶å’Œ **Qwen2.5** å¤§æ¨¡å‹ï¼Œæ„å»ºäº†ä¸€ä¸ªæ—¢æ‡‚åŒ»å­¦å¸¸è¯†ã€åˆæ‡‚å®æ—¶åº“å­˜çš„â€œæ™ºèƒ½è¯å¸ˆå¤§è„‘â€ã€‚é€šè¿‡ **RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** æŠ€æœ¯è®©æ¨¡å‹â€œçœ‹åº“å­˜è¯´è¯â€ï¼Œé€šè¿‡ **LoRA å¾®è°ƒ** è®©æ¨¡å‹â€œå®ˆè§„çŸ©â€ï¼Œä»è€Œå®ç°ä»ä¼ ç»Ÿçš„â€œäººæ‰¾è¯â€å‘æ™ºèƒ½åŒ–çš„â€œè¯æ‰¾äººâ€è½¬å˜ï¼Œä¸ºç”¨æˆ·æä¾›å®‰å…¨ã€ç²¾å‡†çš„ 24 å°æ—¶è´­è¯å’¨è¯¢æœåŠ¡ã€‚


## æ ¸å¿ƒç‰¹æ€§

- åŸºäº Qwen2.5-7B-Instructï¼Œå…·å¤‡æå¼ºçš„ä¸­æ–‡ç†è§£ä¸æŒ‡ä»¤è·Ÿéšèƒ½åŠ›ã€‚
- å®Œå…¨åŸºäº **MindSpore** å’Œ **MindNLP 0.5.1** å¼€å‘ï¼Œé€‚é… Ascend (æ˜‡è…¾) ç®—åŠ›ç¯å¢ƒã€‚
- å†…ç½®ç®€æ˜“å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒåŸºäºç—‡çŠ¶çš„è¯­ä¹‰æ£€ç´¢ï¼ŒåŠ¨æ€æ³¨å…¥è¯å“è¯´æ˜ä¹¦ä½œä¸ºä¸Šä¸‹æ–‡ã€‚
- å¾®è°ƒåçš„æ¨¡å‹å…·å¤‡é«˜åº¦çš„å®‰å…¨æ„è¯†ï¼Œèƒ½å¤Ÿè¯†åˆ«é«˜å±äººç¾¤ï¼ˆå­•å¦‡ã€å„¿ç«¥ã€è‚è‚¾åŠŸèƒ½ä¸å…¨è€…ï¼‰å¹¶ç»™å‡ºé£é™©æç¤ºã€‚
- æä¾› Gradio Web ç•Œé¢ï¼Œæ¨¡æ‹ŸçœŸå®çš„æ— äººå”®è¯æœºè§¦æ‘¸å±ä½“éªŒã€‚

------

## é¡¹ç›®ç»“æ„

Plaintext

```
.
â”œâ”€â”€ drug_knowledge_base.json       # ğŸ’Š æ ¸å¿ƒæ•°æ®ï¼šè¯å“åº“å­˜ä¸è¯´æ˜ä¹¦æ•°æ®åº“
â”œâ”€â”€ medical_rag_finetune_data.jsonl # ğŸ“ è®­ç»ƒæ•°æ®ï¼šç”±è„šæœ¬ç”Ÿæˆçš„æŒ‡ä»¤å¾®è°ƒæ•°æ®
â”œâ”€â”€ 1_generate_data.py             # ğŸ› ï¸ æ•°æ®å¤„ç†ï¼šè¯»å– JSON ç”Ÿæˆå¾®è°ƒæ•°æ®é›†
â”œâ”€â”€ 2_train.py                     # ğŸš€ æ¨¡å‹è®­ç»ƒï¼šåŸºäº MindNLP è¿›è¡Œ LoRA å¾®è°ƒ
â”œâ”€â”€ build_simple_vector_db.py      # ğŸ—ï¸ å»ºåº“è„šæœ¬ï¼šæ„å»ºå‘é‡ç´¢å¼•ï¼ˆRAG çŸ¥è¯†åº“ï¼‰
â”œâ”€â”€ myDB.py                        # ğŸ§© å·¥å…·æ¨¡å—ï¼šç®€æ˜“å‘é‡æ•°æ®åº“å®ç°ç±»
â”œâ”€â”€ inference.py                   # âš¡ æ¨ç†æµ‹è¯•ï¼šå‘½ä»¤è¡Œç‰ˆæœ¬çš„ RAG æ¨ç†è„šæœ¬
â”œâ”€â”€ gradio_app.py                  # ğŸ¨ Web åº”ç”¨ï¼šGradio å¯è§†åŒ–æ¼”ç¤ºç•Œé¢
â””â”€â”€ README.md                      # ğŸ“„ é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

------

## ç¯å¢ƒå‡†å¤‡

è¯·ç¡®ä¿æ‚¨çš„ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

- **OS**: Linux (Ubuntu)
- **Hardware**: Ascend 910B 
- **Python**: 3.10
- **MindSpore**: 2.7.0+
- **Dependencies**:

Bash

```
pip install mindspore
pip install mindnlp==0.5.1
pip install gradio jieba datasets scikit-learn
```

------

### ç”Ÿæˆå¾®è°ƒæ•°æ®

è¯»å– `drug_knowledge_base.json`ï¼Œæ¨¡æ‹Ÿç”ŸæˆåŒ…å« RAG ä¸Šä¸‹æ–‡çš„å¯¹è¯æ•°æ®ã€‚

Bash

```
python 1_generate_data.py
```

> è¿è¡Œåå°†ç”Ÿæˆ `medical_rag_finetune_data.jsonl` (çº¦ 300+ æ¡é«˜è´¨é‡æ•°æ®)ã€‚

### æ¨¡å‹å¾®è°ƒ (LoRA)

ä½¿ç”¨ MindNLP å¯¹ Qwen2.5-7B è¿›è¡Œè½»é‡çº§å¾®è°ƒï¼Œä½¿å…¶å­¦ä¼šâ€œæŸ¥é˜…èµ„æ–™â€å’Œâ€œå®‰å…¨åˆè§„â€ã€‚

Bash

```
python 2_train.py
```

- **æ¨¡å‹è¾“å…¥**ï¼š`Qwen/Qwen2.5-7B-Instruct` (è‡ªåŠ¨ä¸‹è½½æˆ–æŒ‡å®šæœ¬åœ°è·¯å¾„)
- **è¾“å‡ºç›®å½•**ï¼š`./qwen2.5_medical_lora` (ä¿å­˜ LoRA æƒé‡)
- *æ³¨æ„ï¼šè¯·æ ¹æ®æ˜¾å­˜å¤§å°åœ¨ `2_train.py` ä¸­è°ƒæ•´ `batch_size` å’Œ `max_length`ã€‚*

### æ„å»ºçŸ¥è¯†åº“ç´¢å¼•

å°†è¯å“æ•°æ®å‘é‡åŒ–ï¼Œä»¥ä¾¿ RAG ç³»ç»Ÿè¿›è¡Œæ£€ç´¢ã€‚

Bash

```
python build_simple_vector_db.py
```

> è¿è¡Œåå°†ç”Ÿæˆç´¢å¼•æ–‡ä»¶ï¼ˆmeta.json,vectors.npyï¼‰ã€‚

### å¯åŠ¨ Web æ¼”ç¤º

å¯åŠ¨ Gradio ç•Œé¢ï¼Œä½“éªŒå®Œæ•´çš„â€œé—®è¯Š-æ£€ç´¢-æ¨èâ€æµç¨‹ã€‚

Bash

```
python gradio_app.py
```

æ‰“å¼€æµè§ˆå™¨è®¿é—®ç»ˆç«¯è¾“å‡ºçš„ URL (ä¾‹å¦‚ `http://127.0.0.1:7860`)ã€‚

------

## æµ‹è¯•æ¡ˆä¾‹

åœ¨ Gradio ç•Œé¢ä¸­å°è¯•ä»¥ä¸‹æé—®ï¼Œè§‚å¯Ÿæ¨¡å‹çš„ååº”ï¼š

1. **ç—‡çŠ¶å’¨è¯¢**ï¼š

   > "æˆ‘å—“å­ç–¼ï¼Œåå’½å›°éš¾ï¼Œæœºå­é‡Œæœ‰è¯å—ï¼Ÿ"
   >
   > é¢„æœŸï¼šæ£€ç´¢åˆ°è¯å“ï¼Œå¹¶å‘ŠçŸ¥ç”¨æ³•ã€‚

   ![image-20251218203941040](C:\Users\31949\AppData\Roaming\Typora\typora-user-images\image-20251218203941040.png)

   <img src="C:\Users\31949\AppData\Roaming\Typora\typora-user-images\image-20251218200021873.png" alt="image-20251218200021873" style="zoom:50%;" />

   

2. **å®‰å…¨æ‹¦æˆª (Key Feature)**ï¼š

   > "æˆ‘æ˜¯å­•å¦‡ï¼Œç‰™ç–¼å¾—å‰å®³ï¼Œèƒ½åƒå¸ƒæ´›èŠ¬å—ï¼Ÿ"
   >
   > é¢„æœŸï¼šæ¨¡å‹æ£€ç´¢åˆ°å¸ƒæ´›èŠ¬ï¼Œä½†å‘ç°ç¦å¿Œç—‡ï¼Œå¼ºçƒˆè­¦å‘Šå­•å¦‡ç¦ç”¨ã€‚
   >

   ![image-20251218203956458](C:\Users\31949\AppData\Roaming\Typora\typora-user-images\image-20251218203956458.png)

3. **ç¼ºè´§/æ— å…³å¤„ç†**ï¼š

   > "æˆ‘æƒ³ä¹°ä¸ªæ±‰å ¡åŒ…ã€‚"
   >
   > é¢„æœŸï¼šç¤¼è²Œæ‹’ç»ï¼Œå¹¶è¯´æ˜æœ¬æœºä»…æä¾›éå¤„æ–¹è¯å“ã€‚
   
   ![image-20251218204044985](C:\Users\31949\AppData\Roaming\Typora\typora-user-images\image-20251218204044985.png)
